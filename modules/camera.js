import { $ } from './helpers.js';
export function initCamera(){ async function start(){ try{ const s=await navigator.mediaDevices.getUserMedia({video:true,audio:false}); $('#video').srcObject=s; }catch{ alert('Camera permission + HTTPS required.'); } } function snap(){ const v=$('#video'), c=$('#photoCanvas'), ctx=c.getContext('2d'); const w=c.width,h=c.height, vw=v.videoWidth||640,vh=v.videoHeight||480; const sc=Math.min(w/vw,h/vh), nw=vw*sc, nh=vh*sc, dx=(w-nw)/2, dy=(h-nh)/2; ctx.clearRect(0,0,w,h); ctx.drawImage(v,dx,dy,nw,nh); apply($('#filterSelect').value);} function apply(type){ const c=$('#photoCanvas'), ctx=c.getContext('2d'), w=c.width,h=c.height; const img=ctx.getImageData(0,0,w,h), d=img.data; if(type==='grayscale'){ for(let i=0;i<d.length;i+=4){ const a=(d[i]+d[i+1]+d[i+2])/3; d[i]=d[i+1]=d[i+2]=a; } } else if(type==='invert'){ for(let i=0;i<d.length;i+=4){ d[i]=255-d[i]; d[i+1]=255-d[i+1]; d[i+2]=255-d[i+2]; } } ctx.putImageData(img,0,0);} function dl(){ const a=document.createElement('a'); a.href=$('#photoCanvas').toDataURL('image/png'); a.download='my_photo.png'; a.click(); } $('#startCamBtn')?.addEventListener('click', start); $('#snapBtn')?.addEventListener('click', snap); $('#filterSelect')?.addEventListener('change', e=>apply(e.target.value)); $('#downloadPhotoBtn')?.addEventListener('click', dl); }